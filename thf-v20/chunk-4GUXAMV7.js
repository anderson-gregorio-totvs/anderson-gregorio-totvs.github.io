import{Ba as f,Fa as m,Hb as y,Kc as w,T as a,U as r,Ua as p,V as g,ia as h,kb as v,lb as C,mb as M,rb as E,ua as n,xa as u,ya as c,za as l,zc as D}from"./chunk-FIDTK4XA.js";var I=["vs-dark","vs","hc-black"],_="vs",P=(()=>{class i{editor;modifiedValue="";value="";_height=150;_language="plainText";_readonly=!1;_showDiff=!1;_suggestions;_theme=_;set language(e){this._language=e&&e.length?e.trim():"plainText",this.editor&&this._language&&this.setLanguage(this._language)}get language(){return this._language}set readonly(e){this._readonly=e===""?!0:this.convertToBoolean(e),this.editor&&this.setReadOnly(e)}get readonly(){return this._readonly}set showDiff(e){this._showDiff=e===""?!0:this.convertToBoolean(e)}get showDiff(){return this._showDiff}set suggestions(e){this._suggestions=e,this.editor&&this._suggestions&&this.setSuggestions(this._suggestions)}get suggestions(){return this._suggestions}set theme(e){this._theme=I.includes(e)?e:_,this.editor&&this.setTheme(e)}get theme(){return this._theme}set height(e){this._height=parseFloat(e)>=150?parseFloat(e):150}get height(){return`${this._height}px`}onTouched=e=>{};onChangePropagate=e=>{};getOptions(){return{language:this.language,theme:this.theme,readOnly:this.readonly}}registerOnChange(e){this.onChangePropagate=e}registerOnTouched(e){this.onTouched=e}convertToBoolean(e){return typeof e=="string"?(e=e.toLowerCase().trim(),e==="true"||e==="on"||e===""):typeof e=="number"?e===1:!!e}static \u0275fac=function(t){return new(t||i)};static \u0275dir=l({type:i,inputs:{language:[0,"p-language","language"],readonly:[0,"p-readonly","readonly"],showDiff:[0,"p-show-diff","showDiff"],suggestions:[0,"p-suggestions","suggestions"],theme:[0,"p-theme","theme"],height:[0,"p-height","height"]}})}return i})(),R=(()=>{class i{suggestions={};constructor(){}getSuggestion(e,t){if(this.suggestions[e]){let o=this.deduplicateSuggestions(this.suggestions[e],t);return this.suggestions[e]=[...this.suggestions[e],...o],o}else return this.suggestions[e]=[...t]}deduplicateSuggestions(e,t){return t.filter(o=>!e.find(s=>s.label===o.label))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),d=(()=>{class i{language;options;suggestions;static \u0275fac=function(t){return new(t||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),O=["editorContainer"],T=!1,L,S=[{provide:w,useExisting:a(()=>V),multi:!0}],V=(()=>{class i extends P{zone;el;poCodeEditorSuggestionService;codeEditorRegister;editorContainer;canLoad=!1;constructor(e,t,o,s){super(),this.zone=e,this.el=t,this.poCodeEditorSuggestionService=o,this.codeEditorRegister=s}ngAfterViewInit(){T?L.then(()=>{setTimeout(()=>{this.el.nativeElement.offsetWidth?(this.registerCustomLanguage(),this.initMonaco(this.getOptions())):this.canLoad=!0})}):(T=!0,L=new Promise(e=>{let t=()=>{window.require.config({paths:{vs:"./assets/monaco/vs"}}),window.require(["vs/editor/editor.main"],()=>{setTimeout(()=>{this.el.nativeElement.offsetWidth?(this.registerCustomLanguage(),this.initMonaco(this.getOptions())):this.canLoad=!0,e()})})};if(!window.require){let o=document.createElement("script");o.type="text/javascript",o.src="./assets/monaco/vs/loader.js",o.addEventListener("load",t),document.body.appendChild(o)}}))}ngDoCheck(){this.canLoad&&this.el.nativeElement.offsetWidth&&(this.registerCustomLanguage(),this.initMonaco(this.getOptions()),this.canLoad=!1)}monacoCreateModel(e){return monaco.editor.createModel(e)}setValueInEditor(){this.showDiff?setTimeout(()=>{this.editor&&this.editor.setModel({original:this.monacoCreateModel(this.value),modified:this.monacoCreateModel(this.modifiedValue)})}):setTimeout(()=>{this.editor&&this.editor.setValue(this.value)})}setLanguage(e){this.showDiff?(this.setMonacoLanguage(this.editor.getModel().original,e),this.setMonacoLanguage(this.editor.getModel().modified,e)):this.setMonacoLanguage(this.editor.getModel(),e)}setTheme(e){monaco.editor.setTheme(e)}setReadOnly(e){this.editor.updateOptions({readOnly:e})}setSuggestions(e,t=this.language){if(!e)return;let o=this.poCodeEditorSuggestionService.getSuggestion(t,e);monaco.languages.registerCompletionItemProvider(t,{provideCompletionItems:()=>({suggestions:o})})}writeValue(e){this.value=e&&e instanceof Array?e[0]:e,this.modifiedValue=e&&e instanceof Array&&e.length>0?e[1]:"",this.setValueInEditor()}initMonaco(e){this.showDiff?(this.editor=monaco.editor.createDiffEditor(this.editorContainer.nativeElement,e),this.editor.setModel({original:monaco.editor.createModel(this.value),modified:monaco.editor.createModel(this.modifiedValue)}),this.editor.onDidUpdateDiff(t=>{let o=this.editor.getModel().original.getValue(),s=this.editor.getModel().modified.getValue();this.onChangePropagate([o,s])})):(this.editor=monaco.editor.create(this.editorContainer.nativeElement,e),this.editor.setValue(this.value),this.editor.onDidChangeModelContent(t=>{let o=this.editor.getValue();this.onChangePropagate(o),this.zone.run(()=>this.value=o)})),setTimeout(()=>{this.setLanguage(this.language),this.setSuggestions(this.suggestions)},500)}setMonacoLanguage(e,t){monaco.editor.setModelLanguage(e,t)}registerCustomLanguage(){this.codeEditorRegister.language&&(monaco.languages.register({id:this.codeEditorRegister.language}),this.codeEditorRegister.options&&monaco.languages.setMonarchTokensProvider(this.codeEditorRegister.language,this.codeEditorRegister.options),this.codeEditorRegister.suggestions&&this.setSuggestions(this.codeEditorRegister.suggestions.provideCompletionItems().suggestions,this.codeEditorRegister.language))}static \u0275fac=function(t){return new(t||i)(n(m),n(h),n(R),n(d))};static \u0275cmp=u({type:i,selectors:[["po-code-editor"]],viewQuery:function(t,o){if(t&1&&v(O,7),t&2){let s;C(s=M())&&(o.editorContainer=s.first)}},standalone:!1,features:[y(S),f],decls:2,vars:2,consts:[["editorContainer",""]],template:function(t,o){t&1&&p(0,"div",null,0),t&2&&E("height",o.height)},encapsulation:2})}return i})(),U=(()=>{class i{static forRegister(e){return{ngModule:i,providers:[{provide:d,useValue:e}]}}static \u0275fac=function(t){return new(t||i)};static \u0275mod=c({type:i});static \u0275inj=g({providers:[d],imports:[D]})}return i})();export{V as a,U as b};
